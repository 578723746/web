<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>WiX Toolset - New Issue</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/issues/assets/mdd/mdd_styles.css" rel="stylesheet" />
  <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
  <link href="/issues/assets/css/tinybugs.css" rel="stylesheet" />
</head>
<body>
<div class="container">
  <form id='bugForm' method='post'>
    <fieldset>
    <legend>New Issue</legend>
    <div class="row">
    <div class="span11 well well-small">
        <div class="controls-row">
        <div class="span2">
          <div class="row">
            <label for='type' class="span2">Type</label>
            <select id='type' name='type' class="span2" required>
                                          <option value=''></option>
                            <option value='Bug'>Bug</option>
                            <option value='Feature'>Feature</option>
                                        </select>
          </div>
        </div>
        <div class="span3">
          <div class="row">
            <label for='release' class="span3">Release</label>
            <select id='release' name='release' class="span3" title="Please provide the release where the issue was originally encountered.">
              <option></option>
                                                        <option value='v3.8'>v3.8</option>
                            <option value='v3.9'>v3.9</option>
                            <option value='v3.x'>v3.x</option>
                            <option value='v4.0'>v4.0</option>
                            <option value='v4.x'>v4.x</option>
                                        </select>
          </div>
        </div>
        <div class="span3">
          <div class="row">
            <label for='tags' class="span3">Area</label>
            <select id='area' name='area' class="span3" title="Please select the most appropriate area affected by the issue.">
              <option></option>
                                                        <option value='compiler'>compiler</option>
                            <option value='linker'>linker</option>
                            <option value='msbuild'>msbuild</option>
                            <option value='extensions'>extensions</option>
                            <option value='installer'>installer</option>
                            <option value='burn'>burn</option>
                            <option value='wixtoolset.org'>wixtoolset.org</option>
                            <option value='sdk'>sdk</option>
                            <option value='votive'>votive</option>
                                        </select>
          </div>
        </div>
        <div class="span2">
          <div class="row">
            <label class="span1">&nbsp;</label>
            <label for='private' class="checkbox span2 disabled" title="Not implemented yet">
              <input id='private' name='private' type='checkbox'  disabled /> Private issue
            </label>
          </div>
        </div>
        </div>
    </div>
    </div>

    <div id="formError" class="span10 alert alert-error hide">
      <button type="button" class="close">&times;</button>
      <strong>Error!</strong> Please fix the following:
      <ul></ul>
    </div>

    <div id="bugerror" class="span10 alert alert-error hide">
      <button type="button" class="close">&times;</button>
      <strong>Error!</strong> Something went awry while submitting your changes. Please, try again.
    </div>

    <div class="row">

      <div class="span8">
        <label for='title'>Title</label>
        <input id='title' name='title' type='text' class="span8" maxlength='140' placeholder="required" title="Please provide a short descriptive title for the issue." required value="" />

        <div class="mdd_toolbar"></div>
        <textarea id='text' name='text' rows='8' class='span8 mdd_editor' placeholder="required" title="Please provide a detailed explanation of the issue." required></textarea>
        <div><br /><p><strong>Preview</strong></p></div>
        <div class="mdd_preview"></div>
      </div>

      <div class="span3 well well-small">
        <label for='assignedto'>Assign To</label>
        <input id='assignedto' name='assignedto' type='text' class="typeahead span3"
               data-url='/issues/api/user/' autocomplete="off" value="" />


        <div class="form-actions">
          <button id='submit' type="submit" class="btn btn-block btn-warning" data-loading-text="Saving...">Save</button>
          <a href="/issues/" class="btn btn-block">Cancel</a>
        </div>
      </div>
    </div>
    </fieldset>
  </form>
  <div id="loginModal" class="login modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <form id='loginForm' method='post' action="/issues/api/session/">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3 id="loginHeader">Login</h3>
  </div>
  <div id="loginerror" class="alert alert-error hide">
    <button type="button" class="close">&times;</button>
    <strong>Error!</strong> Invalid username or password. Please, try again.
  </div>
  <div class="modal-body">
      <label for='username'>Username</label>
      <input id='username' name='username' type='text' placeholder="username" required='required' />
      <label for='password'>Password</label>
      <input id='password' name='password' type='password' required='required' />
      <p>New here? Cool, <a href="/issues/login/create/">create an account</a>.</p>
  </div>
  <div class="modal-footer">
      <button id='attemptlogin' type="submit" class="btn btn-primary" data-loading-text="Logging in...">Submit</button>
      <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
  </div>
  </form>
</div>
</div>
<script src="//ajax.aspnetcdn.com/ajax/jQuery/jquery-1.10.2.min.js"></script>
<script src="//ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script src="/issues/assets/mdd/markdowndeeplib.min.js"></script>
<script src="/issues/assets/js/tinybugs.js"></script>
<script>
$(function () {
  $("textarea.mdd_editor").MarkdownDeep({
    resizebar: false,
    help_location: "/issues/assets/mdd/mdd_help.htm",
  });

  $('#triage').on('click', function (e) {
    updateStatusSubmitButton('', '', 'btn-primary');
  });

  $('#resolution').keyup(function (e) {
    updateStatusSubmitButton('', '', 'btn-primary');
  });

  $('#bugForm').validate({
    validClass: 'success',
    errorContainer: "#formError",
    errorLabelContainer: "#formError ul",
    wrapper: "li",
    invalidHandler: function (event, validator) {
      var errors = validator.numberOfInvalids();
      if (errors) {
        $(this).slideDown();
      }
      else {
        $(this).find('.alert').slideUp('fast');
      }
    },
    submitHandler: function (form) {
      var submit = $(form).find(':submit').button('loading');
      var alert = $('#bugerror').slideUp('fast');

      $.post('/issues/api/issue/', $(form).serialize())
          .done(function (data) {
            clearDirty();
            window.location.href = data.location;
          }).fail(function (jqXHR, textStatus, errorThrown) {
            if (errorThrown === 'Unauthorized' || errorThrown == 'Bad Gateway') {
              $('#loginModal').modal();
            }
            else {
              alert.slideDown();
            }

            submit.button('reset');
          });
    }
  });

  enableDirtyCheck("There are edits to this bug report. Do you want to abandon them?");
  updateStatusSubmitButton('', '', 'btn-primary');
});
</script>
</body>
</html>
